\chapter{Введение}

\definition

\definitionfont{Организованные системы} --- системы, в которых решения принимаются <<сознательно>>. Примеры таких систем: люди, промышленные предприятия, магазины.

\bigskip

\noindent Примеры задач:
\begin{itemize}[nosep]
	\item Где построить магазин, чтобы получать наибольшую прибыль?
	
	\item Сколько производить деталей на заводе, чтобы отношение между доходом и выручкой было наибольшим?
\end{itemize}

\bigskip

\noindent\fbox{
	\parbox{\linewidth}{
		\qquad Примерно до второй мировой войны все сложные решения принимались лишь на основе опыта и здравого смысла. Однако позже появились сложные системы, в которых опыта и здравого смысла оказалось недостаточно. Тогда же появилась \textbf{идея} рассматривать числовые характеристики систем для принятия решения, при этом должны использоваться \definitionfont{математические модели} --- упрощённые, но адекватные описания реальной жизни.
	}
}

\section{Построение математических моделей}

\noindent
\fbox{
	\parbox{\linewidth}{
		\qquad Математические модели строятся на основании \definitionfont{исходных данных} --- конкретных проблем в конкретных жизненных ситуациях.
	}
}

\bigskip

\textbf{Примерный алгоритм построения математических моделей}

\begin{enumerate}[nosep]
	\item Нужно понять, \textit{что будем оптимизировать?} По каким критериям будет оценивать решения? Например, если нас спрашивают, где построить магазин, то нам нужно понять, как выбрать для этого место. Нужно, чтобы была максимальная прибыль или чтобы наибольшая удалённость от конкурентов? Если мы закупаем детали для предприятия, то нужно узнать, хочется ли нам наибольшую прибыль или же минимальные издержки. А может нам важно количество произведённой продукции?
	
	\item Нужно понять, \textit{какие характеристики существенно влияют на оптимизируемую характеристику}? Например, если наша оптимизируемая характеристика --- это прибыль предприятия, то нужно определить, из чего складываются выручка и затраты.
	
	\item \textit{Формулировка задачи} с точным указанием всех характеристик. Каждая из характеристик должна относиться либо к \definitionfont{переменным}, либо к \definitionfont{параметрам}. Первые могут меняться (обозначаются они через $x, y, z, \dots$), а вторые --- это константы (обозначаются они через $a, b, c, \dots$). Например, переменные --- это выручка и затраты предприятия, а параметры --- это площадь помещения, количество станков, количество работников.
	
	\item Выбор всех обозначений и математическая запись с учётом ограничений и требований для переменных.
	
	\item Понимание, что изначальная проблема состоит в другом, не учтены такие-то параметры, значит нужно вернуться к самому началу...
\end{enumerate}

\example

Ваш друг плывёт на лодке, ему нужно попасть в определённую точку на берегу, и он спрашивает вас, куда ему нужно причалить.

\begin{center}
	\begin{tikzpicture}
		\draw[black, very thick] (-1, -1) -- (4.5, 2.3);
		\draw[gray, dashed] (4.5, -1.1) -- (3, 1.4);
		\filldraw[black] (0.5, -0.1) circle (2pt) node[anchor=south]{A};
		\filldraw[black] (3, 1.4) circle (2pt) node[anchor=south]{B};
		\filldraw[black] (2, 0.8) circle (2pt) node[anchor=south]{O};
		\filldraw[black] (4.5, -1.1) circle (2pt) node[anchor=west]{C};
		\draw [-{Stealth[length=2.5mm]}] (2, -0.5) -- node[above=1mm] {\text{Лодка\quad\;}} (4.2, -1.1);
		\draw [-{Stealth[length=2.5mm]}] (-2, -3.5) -- node[above=1mm] {\text{Берег\quad\;}} (0, -0.7);
		\draw [|<->|] (1.60294, 1.46176) -- node[above=1mm] {$x$} (2.60294, 2.06176);
		\draw [|<->|] (2.16176, 2.79706) -- node[above=1mm] {$15$} (-0.33824, 1.29706);
		\draw [|<->|] (5.42647, -0.54412) -- node[above=1mm] {$9$} (3.92647, 1.95588);
	\end{tikzpicture}
\end{center}

\textbf{Характеристики рассматриваемой системы}
\begin{itemize}[nosep]
	\item $C$ --- текущее местоположение лодки;
	
	\item $A$ --- точка, в которую нужно попасть;
	
	\item $B$ --- ближайшая к лодке точка берега;
	
	\item $O$ --- точка причаливания;
	
	\item $AB$ = 15 км;
	
	\item $BC$ = 9 км (расстояние от лодки до берега);
	
	\item $v_{\text{по суше}} = 5$ км/ч;
	
	\item $v_{\text{лодки}} = 4$ км/ч;
	
	\item $OB = x$;
	
	\item течения воды нет, то есть скорость течения равна нулю;
	
	\item цвет лодки не существенен.
\end{itemize}

\bigskip

Будем оптимизировать время $t$
\begin{align*}
	t &= \underbrace{\frac{OC}{v_{\text{по воде}}}}_{\text{движение по воде}} + \underbrace{\frac{OA}{v_{\text{по суше}}}}_{\text{движение по суше}} \\
	&= \boxed{\frac{\sqrt{x^2+81}}{4} + \frac{15 - x}{5} \to \min_x}
\end{align*}

Установим \textbf{ограничение}
\[
0 \le x \le 15,
\]

потому что иначе решение будет точно неоптимальным.

\bigskip

Решим задачу, найдя нули производной
\[\derivative{t}{x} = \frac{2x}{8\sqrt{x^2+81}} - \frac{1}{5} = 0,\]
\[\frac{x}{4\sqrt{x^2+81}} = \frac{1}{5},\]
\[\frac{x^2}{16(x^2 + 81)} = \frac{1}{25},\]
\[	25x^2 = 16x^2 + 16 \cdot 81,\]
\[9x^2 = 16 \cdot 81,\]
\[x^2 = 16 \cdot 9,\]
\[x_1 = -12, \qquad x_2 = 12.\]

Решение $x_1 = -12$ не подходит ввиду ограничения выше, а вот $\boxed{x = 12}$ является ответом (упражнение).

\section{Оптимизационные (экстремальные) задачи}

\definition[экстремальная задача]

\definitionfont{Экстремальная задача} формулируется следующим образом

\begin{enumerate}[nosep]
	\item Есть функция $f(x)$, значение которой нужно оптимизировать;
	
	\item Есть набор ограничений $g_1(x) \le b_1, g_2(x) \le b_2, \dots$;
	
	\item $x \in X$, $X$ --- \definitionfont{множество всех решений},
\end{enumerate}

при этом \definitionfont{нужно найти}
\[
\min_{x \in X} f(x) \quad \text{или} \quad \max_{x \in X} f(x).
\]

\definition

\definitionfont{Допустимые решения} --- множество всех значений $x \in X$, которые удовлетворяют всем ограничения $\{g_i\}$.

\definition

Допустимое решение $x^*$ называется \definitionfont{оптимальным решением задачи}, если
\[
\forall x \in X \qquad f(x^*) \ge f(x).	
\]

или то же самое
\[
f(x^*) = \max_{x \in X} f(x).	
\]

\remark

Ограничения $\{g_i\}$ могут быть какими угодно.

\example

Пусть наши исходные данные это
\[f(x) = c_1 x_1 + c_2 x_2 \to \max_x,\]
\[g(x) = ax_1 + bx_2 \le d,\]
\[x_1 \ge 0, \quad x_2 \ge 0.\]

Нужно найти $x_1$ и $x_2$.

\definition

Будем говорить, что есть $\P$ --- \definitionfont{общая задача}, а $p \in \P$ --- конкретная задача, в которой $c_1, c_2, a, b, d$ --- это конкретные числа. То есть \definitionfont{общая задача} --- это множество конкретных задач.

\definition

\definitionfont{Длина входа задачи} --- это количество ячеек в памяти, которое занимает задача с допущением, что каждое число занимает в памяти ровно одну ячейку. Будем обозначать это $\abs{p}$.

\section{Алгоритмы}

\definition

\definitionfont{Элементарные операции} --- арифметические операции и операции сравнения.

\definition

\definitionfont{Трудоёмкость алгоритма} $A$ решения задачи $p \in \P$ --- это количество элементарных операций, используемых в этом алгоритме. Будем обозначать это $T_A(p)$.

\remark

Чем больше $\abs{p}$, тем больше $T_A(p)$, поэтому будем оценивать трудоёмкость так
\[
T_A(p) \le f_A\big(\abs{p}\big).
\]

\definition

Если $f_A\big(\abs{p}\big) = C \cdot \abs{p}^k$, то такой алгоритм будем называть \definitionfont{<<хорошим>>} (\definitionfont{полиномиальным}).

Примерами задач, для которых существуют <<хорошие>> алгоритмы, являются математические задачи, в которых $x$ --- множество векторов (линейное и нелинейное программирование), и задачи комбинаторики (например, перестановки).

\definition[задача линейного программирования]

\[\sum_{j=1}^{n} c_j x_j \to \max_{(x_j)},\]
\[\sum_{j=1}^{n}a_{ij} x_j \le b_i, \quad i = 1\dots m,\]
\[x_j \in \{0, 1, 2, \dots\} \text{ или то же самое } x_j \ge 0, \quad j = 1\dots n.\]

\textbf{Распространённый частный случай}: $x_j \in \{0, 1\}$.

\section{Задачи}

\problem[о машине на острове]

На некотором острове есть машина; для работы машины нужны детали, которые могут изнашиваться. В скором времени нужно будет вызвать самолёт, который сможет доставить необходимые детали, однако максимальная масса груза ограничена. Сколько деталей какого типа нужно заказать?

\textbf{1. Что будем оптимизировать?} Ответ: машина должна работать максимальное время.

\textbf{2. Что существенно влияет на оптимизируемую характеристику?}

\begin{itemize}
	\item $i = 1 \dots n$ --- вид детали;
	
	\item $m = \{m_i\}_{i=1}^n$ --- масса деталей;
	
	\item $t = \{t_i\}_{i=1}^n$ --- срок службы деталей;
	
	\item $x = \{x_i\}_{i=1}^n$ --- сколько нужно взять деталей в посылку;
	
	\item $a = \{a_i\}_{i=1}^n$ --- количество работающих деталей в машине;
	
	\item $M$ --- максимальная масса посылки;
\end{itemize}

\textbf{3. Математическая формулировка задачи}

Пусть $T$ --- время работы машины, тогда
\[
T = \min_{i = 1 \dots n} \big((x_i + a_i) \cdot t_i\big) \to \max_{(x_i)}
\]
\[
\sum_{i=1}^{n} n_i x_i \le M
\]

\problem[о салфетках]

Пусть есть некоторое кафе, в которое каждый день ходят люди, при этом известно, сколько человек посещает кафе каждый день недели. Каждому гостю выдают салфетку, которую вечером стирают. Салфетки можно стирать с помощью \textit{быстрой} и \textit{медленной} стирок. Первая --- дорогая, но работает условно моментально, вторая --- дешёвая, но выдача постиранных салфеток происходит лишь через день. Как сэкономить деньги на стирке так, чтобы всем посетителям всегда хватало салфеток?

\textbf{1. Что будем оптимизировать?} Ответ: нужно минимизировать затраты на стирку.

\textbf{2. Что существенно влияет на оптимизируемую характеристику?}

\begin{itemize}[nosep]
	\item $i = 1 \dots 7$ --- день недели;
	
	\item $c_1$ --- цена быстрой стирки;
	
	\item $c_2$ --- цена медленной стирки;
	
	\item $T$ --- общее количество салфеток в кафе;
	
	\item $p_i$ --- количество гостей в $i$-ый день недели;
	
	\item $x_i$ --- количество салфеток в быстрой стирке, отданных в $i$-ый день недели;
	
	\item $y_i$ --- количество салфеток в медленной стирке, --- $\dots$ ---;
	
	\item $C$ --- затраты на стирку за неделю.
\end{itemize}

\textbf{3. Математическая формулировка задачи}

\[
C = \sum_{i=1}^7 (c_1 x_i + c_2 y_i) \to \min_{(x_i), (y_i)}
\]
\[
x_i + y_i = p_i,
\]
\[
x_i \ge 0, \quad y_i \ge 0,
\]
\[
\begin{cases}
	T - y_7 \ge p_1, \\
	T - y_1 \ge p_2, \\
	T - y_2 \ge p_3, \\
	\dots \\
	T - y_5 \ge p_6, \\
	T - y_6 \ge p_7.
\end{cases}
\]

Последние семь неравенств означают, что всем посетителям всегда хватает салфеток.

\problem[раскроя]

Вашему знакомому сантехнику нужно определённое количество коротких труб, однако в магазине можно купить только длинные. Сколько нужно купить длинных труб, чтобы их можно было раскроить на нужные короткие?

Для конкретики пусть вашему знакомому нужно
\begin{itemize}[nosep]
	\item 10 труб по 6 м,
	
	\item 15 труб по 5 м,
	
	\item 26 труб по 4 м,
\end{itemize}

а в магазине продаются лишь трубы длиной 13 м.

\solution

\textbf{1. Что будем оптимизировать?} Ответ: нужно минимизировать число покупаемых труб длиной 13 м.

\textbf{2. Что существенно влияет на оптимизируемую характеристику?}

Рассмотрим все варианты, как можно раскроить длинную трубу на короткие

\begin{table}[h!]
	\centering
	\begin{tabular}{| c | c | c | c | } 
		\hline
		№ & 6 м & 5 м & 4 м \\ 
		\hline
		1 & 2 & 0 & 0 \\\hline
		2 & 1 & 1 & 0 \\\hline
		3 & 1 & 0 & 1 \\\hline
		4 & 0 & 2 & 0 \\\hline
		5 & 0 & 1 & 2 \\\hline
		6 & 0 & 0 & 3 \\\hline
	\end{tabular}
\end{table}

То есть раскроить длинную трубу на короткие можно шестью разными способами. Например, на две трубы длиной 6 метров, на одну трубу длиной 6 метров и на одну трубу длиной 5 метров и т.д.

\begin{itemize}
	\item $x_i$ --- количество труб, раскроенных $i$-ым способом;
	
	\item $T$ --- количество изрезанных труб длиной 13 метров;
\end{itemize}

\textbf{3. Математическая формулировка задачи}

\[
T = \sum_{i=1}^6 x_i \to \min_{(x_i)}
\]
\[
\begin{cases}
	2x_1 + x_2 + x_3 \ge 10 \\
	x_2 + 2x_4 + x_5 \ge 15 \\
	x_3 + 2x_5 + 3x_6 \ge 26
\end{cases}
\]

Первое неравенство для труб длиной 6 метров, второе --- 5 метров, третье --- 4 метра.

\remark

В общем случае задаче раскроя является NP-полной.

\section{Свойства оптимизационных задач}

\fact

\[
\max_x f(x) = \max_x \Big(\big(-1\big) \cdot \big(-f(x)\big)\Big) = \underbrace{-\min_x \big(-f(x)\big)}_{\text{новая задача}}.
\]

\fact[оценка сверху, релаксированные задачи]

Если $X \subseteq X'$, то
\[
\max_{x \in X} f(x) \le \max_{x \in X'} f(x).
\]

\definition

Пусть есть две общие задачи: $(\P) \max_{x \in X} f(x)$ и $(\Q) \max_{y \in Y} g(y)$. Будем говорить, что задача $\P$ \definitionfont{сводится к задаче} $\Q$, если
\[
\forall p \in \P \quad \forall q \in \Q
\]

\begin{enumerate}[nosep]
	\item существует полиномиальный алгоритм $A_1$, который переводит входные данные задачи $p$ во входные данные задачи $q$;
	\[
	p \qquad \stackrel{A_1}{\longrightarrow} \qquad q
	\]
	
	\item существует полиномиальный алгоритм $A_2$, с помощью которого можно из оптимального решения $y^0$ задачи $q$ построить оптимальное решение $x^*$ задачи $p$.
	\[
	x^* \qquad \stackrel{A_2}{\longleftarrow} \qquad y^0
	\]
\end{enumerate}

\textit{Остаётся вопрос}: как понять, что построенное решение $x^*$ --- оптимальное?

\remark

Везде далее всегда будем оптимизировать именно $\max$, а не $\min$.

\fact[сведение к другой задаче]\label{fact:reduction_to_other_problem}

Пусть есть 2 задачи: $\P$ и $\Q$, при этом
\begin{enumerate}[nosep]
	\item $x^0$ --- допустимое решение задачи $\P$,
	
	\item $y^*$ --- оптимальное решение задачи $\Q$,
	
	\item $f(x^0) \ge g(y^*)$,
	
	\item $\forall x \in X \; \exists y \in Y \quad f(x) \le g(y)$,
\end{enumerate}

тогда $x^0$ --- оптимальное решение задачи $\P$.

\prooof

Пусть задача $\P$ имеет оптимальное решение $x^*$. По четвёртому пункту для $x^*$ существует некоторый $y^0$ такой, что 
\[
f(x^*) \le g(y^0). \tag{*}
\]

По условию $y^*$ является оптимальным решением задачи $\Q$, значит верно следующее
\[
g(y^*) \ge g(y^0). \tag{**}
\]

Составим цепочку неравенств

\[
f(x^0) \stackrel{(3)}{\ge} g(y^*) \stackrel{(**)}{\ge} g(y^0) \stackrel{(*)}{\ge} f(x^*).
\]

Таким образом имеем неравенство
\[
f(x^0) \ge f(x^*)
\]

хотя $x^*$ --- оптимальное решение задачи $\P$. Значит $x^0 = x^*$, то есть $x^0$ является оптимальным.

\example

$(\P)$
\[\sum_{j=1}^{n} c_j x_j \to \max_{(x_j)},\]
\[\sum_{j=1}^{n} a_j x_j \le b \tag{1},\]
\[x_1 + x_2 = d \tag{2},\]
\[x_j \ge 0, \quad j = 1\dots n. \tag{3}\]

Заметим, что $x_1$ можно выразить через $x_2$ (и наоборот). Рассмотрим другую задачу

$(\Q)$
\[c_1(d - y_2) + \sum_{j=2}^{n} c_j y_j \to \max_{(y_j)},\].
\[a_1 (d-y_2) + \sum_{j=2}^{n}a_j y_j \le b,\].
\[y_j \ge 0, \quad j = 1\dots n,\]
\[y_2 \le d.\]

Покажем, что задача $\P$ сводится к задаче $\Q$.

\prooof

Пусть $y^* = \begin{pmatrix} y^*_1 & \dots & y^*_n \end{pmatrix}$ --- это оптимальное решение задачи $\Q$. Будем строить решение $x^0$ задачи $\P$ следующим образом
\[
x^0_j = \begin{cases}
	d - y_2,& j = 1 \\
	y_j,& j > 1
\end{cases}
\]

то есть $x^0 = \begin{pmatrix} d - y_2 & y_2 & y_3 & \dots & y_n \end{pmatrix}$.

\begin{enumerate}[nosep]
	\item Покажем, что $x^0$ --- допустимое решение задачи $\P$. Для этого нужно показать, что оно удовлетворяет всем ограничениям. Заметим, что без условия $y_2 \le d$ значение $x_1$ может быть меньше нуля, а значит решение $x^0$ точно было бы не допустимым (ограничение 3).
	
	\begin{enumerate}
		\item Проверим ограничение 2
		\[
		x^0_1 + x^0_2 = d - y^*_2 + y^*_2 = d.
		\]
		
		\item Проверим ограничение 1
		\begin{align*}
			\sum_{j=1}^{n} a_j x^0_j =& \; a_1 x^0_1 + a_2 x^0_2 + \dots + a_n x^0_n \\
			=& \; a_1 (d - y^*_2) + a_2 y^*_2 + \dots + a_n y^*_n \\
			=& \; a_1 (d-y^*_2) + \sum_{j=2}^{n}a_j y^*_j \le b.
		\end{align*}
		
		Значит $x^0$ удовлетворяет всем ограничениям, а поэтому $x^0$ --- допустимое решение.	
	\end{enumerate}
	
	\item Мы показали, что $x^0$ --- допустимое решение задачи $\P$. Осталось показать, что оно оптимальное. Для этого будем использовать \cref{fact:reduction_to_other_problem}.
	
	\begin{enumerate}
		\item Выполнимость условия $f(x^0) \ge g(y^*)$ следует из того, что при подстановке, использованной при проверке ограничения 1, получится равенство
		\[
		f(x^0) = g(y^*).
		\]
		
		\item Выполнимость условия
		\[
		\forall x \in X \; \exists y \in Y \quad f(x) \le g(y)
		\]
		
		следует из того, что по любому $x = (x_j)$ можно построить $y = (y_j)$ следующим образом
		\[
		y_j = \begin{cases}
			d - x_2,& j = 1 \\
			x_j,& j > 1
		\end{cases}
		\]
		
		И вновь, если всё аккуратно подставить, то получится равенство
		\[
		f(x) = g(y).
		\]
	\end{enumerate}
\end{enumerate}

Таким образом мы доказали, что можно применить \cref{fact:reduction_to_other_problem}, значит $\P \mapsto \Q$.

Мы взяли задачу с $n$ переменными и перешли от неё к задаче с $n-1$ переменными. Разве не круто?!

\problem[задача о салфетках]

Решим задачу о салфетках (НУЖНА ССЫЛКА) с помощью сведения к другой задаче. Пусть у нас есть исходная задача $\P$, которая формулируется следующим образом

\begin{itemize}[nosep]
	\item $i = 1 \dots 7$ --- день недели;
	
	\item $c_1$ --- цена быстрой стирки;
	
	\item $c_2$ --- цена медленной стирки;
	
	\item $T$ --- общее количество салфеток в кафе;
	
	\item $p_i$ --- количество гостей в $i$-ый день недели;
	
	\item $x_i$ --- количество салфеток в быстрой стирке, отданных в $i$-ый день недели;
	
	\item $y_i$ --- количество салфеток в медленной стирке, --- $\dots$ ---;
	
	\item $C$ --- затраты на стирку за неделю.
\end{itemize}

\[
C = \sum_{i=1}^7 (c_1 x_i + c_2 y_i) \to \min_{(x_i), (y_i)}
\]
\[
x_i + y_i = p_i,
\]
\[
x_i \ge 0, \quad y_i \ge 0,
\]
\[
\begin{cases}
	T - y_7 \ge p_1, \\
	T - y_1 \ge p_2, \\
	T - y_2 \ge p_3, \\
	\dots \\
	T - y_5 \ge p_6, \\
	T - y_6 \ge p_7.
\end{cases}
\]

Сведём задачу $\P$ к задаче $\Q$, выразив $x_i$ через $y_i$
\[
x_i = p_i - y_i.
\]

Запишем оптимизируемую характеристику в новой задаче $\Q$
\begin{align*}
	C =& \sum_{i=1}^7 \big(c_1 (p_i - y_i) + c_2 y_i\big) \to \min_{(y_i)} \\
	=&  \sum_{i=1}^7 \big(y_i (c_2 - c_1) + c_1 p_i\big) \to \min_{(y_i)} \\
	=& \underbrace{(c_2 - c_1)}_{\const, <0} \sum_{i=1}^7 y_i + \underbrace{c_1 \sum_{i=1}^{7} p_i}_{\const} \to \min_{(y_i)} \\
	\sim& \sum_{i=1}^7 y_i \to \max_{(y_i)}
\end{align*}

Итого в задаче $\Q$ имеем
\[
\sum_{i=1}^7 y_i \to \max_{(y_i)}
\]

\[
\begin{cases}
	T - y_7 \ge p_1, \\
	T - y_1 \ge p_2, \\
	T - y_2 \ge p_3, \\
	\dots \\
	T - y_5 \ge p_6, \\
	T - y_6 \ge p_7.
\end{cases}
\]

Нам нужно ввести ограничения $p_i - y_i \ge 0$ (это ещё при переходе от $\P$ к $\Q$). Теперь если взять следующие значения
\[
y_1^* = \min\{p_1, T - p_2\},
\]
\[
y_2^* = \min\{p_2, T - p_3\},
\]
\[
\dots
\]
\[
y_6^* = \min\{p_6, T - p_7\},
\]
\[
y_7^* = \min\{p_7, T - p_1\}.
\]

Тогда для задачи $\Q$ решение $y^*$ будет являться оптимальным. Теперь можно найти оптимальное решение задачи $\P$
\[
x_i^* = p_i - y_i^*.
\]

Таким образом, мы свели исходную задачу $\P$ к новой задаче $\Q$ с меньшим числом переменных, решили задачу $\Q$ и по её оптимальному решению построили оптимальное решение исходной задачи.

\section{Использование булевых переменных}

\fbox{
	\parbox{\linewidth}{
		\qquad Очень часто в реальных задачах встречаются самые разные логические условия. Например: <<если верно ..., то должно быть верно ...>>. Данные условия можно записать на языке формул математической логики, однако в рамках данного курса будет удобнее, если они будут записаны с использованием алгебраических выражений. Таким образом мы сможем записать любые ограничения любых задач на языке алгебры. Для записи логических условий хорошо подходят булевы переменные. Это переменные, которые могут принимать лишь два значения --- 0 и 1.
	}
}

\fact[простые условия]\label{fact:simple_conditions}

Пусть у нас есть два логических условия $A$ и $B$, и нам нужно записать на языке алгебры логическое выражение <<если верно $A$, то верно $B$>>. Для этого введём две булевы переменные $x$ и $y$, смысл этих переменных будет следующий
\[
x = \begin{cases}
	0, & \text{$A$ --- истина} \\
	1, & \text{$A$ --- ложь}
\end{cases}
\]

\[
y = \begin{cases}
	0, & \text{$B$ --- истина} \\
	1, & \text{$B$ --- ложь}
\end{cases}
\]

Рассмотрим всевозможные комбинации событий $A$ и $B$ на языке булевых переменных.

\begin{enumerate}[nosep]
	\item <<Если верно $A$, то верно $B$>>. На языке наших переменных это записывается как <<если $x = 0$, то $y = 0$>>. Будем записывать это алгебраически следующим образом
	\[
	x \ge y.
	\]
	
	\begin{itemize}[nosep]
		\item Если $x = 0$, то $y$ не может быть равен 1, потому что $0 \ngeq 1$, значит $y$ может равняться лишь 0.
		
		\item Если $x = 1$, то $y$ может равняться как 0, так и 1, поскольку $1 \ge 0$ и $1 \ge 1$.
	\end{itemize}
	
	Значит наше неравенство по смыслу совпадает с исходным логическим условием.
	
	\item Условие <<если $x = 0$, то $y = 1$>> записывается как
	\[
	x \ge 1 - y.
	\]
	
	\begin{itemize}[nosep]
		\item Если $x = 0$, то $1-y$ не может быть равен 1, а значит $1-y=0$, как следствие $y = 1$.
		
		\item Если $x = 1$, то $1-y$ может равняться как 0, так и 1, значит $y$ может принимать любое значение из $\{0, 1\}$.
	\end{itemize}
	
	Записать через $x \ge y - 1$ было бы некорректно, поскольку при $y = 0$ в правой части получилось бы отрицательное число, а при использовании булевых переменных нужно оперировать лишь 0 и 1.
	
	\item <<Если $x = 1$, то $y = 0$>>. По аналогии с предыдущим пунктом это записывается как
	\[
	1-x \ge y.
	\]
	
	\item <<Если $x = 1$, то $y = 1$>>. По аналогии с предыдущими пунктами это записывается как
	\[
	1-x \ge 1 - y,
	\]
	
	или то же самое
	\[
	x \le y.
	\]
	
\end{enumerate}

\textbf{Подытожим}
\begin{enumerate}
	\item \fbox{<<Если $x = 0$, то $y = 0$>>} \qquad\qquad $x \ge y$.
	
	\item \fbox{<<Если $x = 0$, то $y = 1$>>} \qquad\qquad $x \ge 1 - y$.
	
	\item \fbox{<<Если $x = 1$, то $y = 0$>>} \qquad\qquad $1- x \ge y$.
	
	\item \fbox{<<Если $x = 1$, то $y = 1$>>} \qquad\qquad $1 - x \ge 1 - y$ \quad $\Longleftrightarrow$ \quad $x \le y$.
\end{enumerate}

\fact[сложные условия]\label{fact:complex_conditions}

Пусть теперь у нас есть множества условий $\mathcal{A} = \{A_i\}$ и $\mathcal{B} = \{B_k\}$, которым мы будем сопоставлять булевы переменные $x$ и $y$.

\begin{enumerate}[nosep]
	\item Пусть нам хочется алгебраически записать следующее условие: <<если некоторые условия из множества $\mathcal{A}$ истины (а остальные ложны), то все условия из множества $\mathcal{B}$ истины>>. Введём булев вектор $x = (x_i)$, соответствующий условиям из $\mathcal{A}$. Также введём не пересекающиеся множества индексов $I^0, I^1 \subset I$, соответствующие верным и неверным условиям из $\mathcal{A}$ следующим образом
	\[
	x_i = \begin{cases}
		0,& i \in I^0 \Leftrightarrow \text{$A_i$ --- истина}\\
		1,& i \in I^1 \Leftrightarrow \text{$A_i$ --- ложь}\\
	\end{cases}
	\]
	
	Ещё введём булевы переменную $y$, которая обозначает следующее
	\[
	y = \begin{cases}
		0, &\text{все условия из $\mathcal{B}$ истины} \\
		1, &\text{не все условия из $\mathcal{B}$ истины}
	\end{cases}
	\]
	
	Фактически нам бы хотелось записать следующее: <<если вектор $x$ имеет такой вид, то $y = 0$>>. Записать алгебраически это можно следующим образом
	\[
	\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i \ge y.
	\]
	
	Действительно, если вектор $x$ имеет нужный нам вид, то обе суммы равняются нулю, значит $y$ ничего не остаётся кроме как быть равным нулю.
	
	\item  Пусть нам хочется алгебраически записать следующее условие: <<если все события из $\mathcal{A}$ истины, то некоторые условия из множества $\mathcal{B}$ истины (а остальные ложны)>>. Введём булев вектор $y = (y_k)$, соответствующий условиям из $\mathcal{B}$. Также введём не пересекающиеся множества индексов $K^0, K^1 \subset K$, соответствующие верным и неверным условиям из $\mathcal{B}$ следующим образом
	\[
	y_k = \begin{cases}
		0,& k \in K^0 \Leftrightarrow \text{$B_k$ --- истина}\\
		1,& k \in K^1 \Leftrightarrow \text{$B_k$ --- ложь}\\
	\end{cases}
	\]
	
	Ещё введём булевы переменную $x$, которая обозначает следующее
	\[
	x = \begin{cases}
		0, &\text{все условия из $\mathcal{A}$ истины} \\
		1, &\text{не все условия из $\mathcal{A}$ истины}
	\end{cases}
	\]
	
	Фактически нам бы хотелось записать следующее: <<если $x = 0$ , то $y$ имеет такой-то вид>>. Записать алгебраически это можно следующим образом
	\[
	\abs{K^0 \cup K^1} \cdot x  \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
	
	Зачем здесь нужен коэффициент $\abs{K^0 \cup K^1}$?. Если $x = 0$, то наше условие соблюдается, поскольку в правой части тогда обе суммы должны равняться нулю, а значит $y$ принимает нужным нам вид. Однако дело в том, что если $x \neq 0$, то $y$ должен иметь возможность принимать любые значения (посылка ложна), однако алгебраически это не так. Теоретически правая часть может быть сколь угодно большой, а правая часть без коэффициента может лишь не больше 1. Это означает, что наше алгебраическое выражение по смыслу не совпадает с изначальными логическими условиями. Чтобы оно совпадало, нужно разрешить $y$ принимать любые значения при $x \neq 0$. Для этого как раз и добавлен коэффициент в левой части неравенства, чтобы неравенство оставалось верным при $x = 1$ и сколь угодно большой правой части.
	
	\item Рассмотрим самый общий случай: <<если некоторые условия из $\mathcal{A}$ истины (а остальные ложны), то некоторые условия из множества $\mathcal{B}$ истины (а остальные ложны)>>. Для этого введём булевы векторы $x = (x_i)$ и $y = (y_k)$, соответствующие условиям из $\mathcal{A}$ и $\mathcal{B}$ соответственно. Также аналогично с двумя предыдущими пунктами введём множества $I^0, I^1 \subset I$ и $K^0, K^1 \subset K$ следующим образом
	\[
	x_i = \begin{cases}
		0,& i \in I^0 \Leftrightarrow \text{$A_i$ --- истина}\\
		1,& i \in I^1 \Leftrightarrow \text{$A_i$ --- ложь}\\
	\end{cases}
	\]
	\[
	y_k = \begin{cases}
		0,& k \in K^0 \Leftrightarrow \text{$B_k$ --- истина}\\
		1,& k \in K^1 \Leftrightarrow \text{$B_k$ --- ложь}\\
	\end{cases}
	\]
	
	Фактически нам бы хотелось записать следующее: <<если $x$ имеет такой-то вид, то $y$ имеет такой-то вид>>. Записать алгебраически это можно следующим образом
	\[
	\abs{K^0 \cup K^1} \cdot \Big(\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i\Big) \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
	
	Коэффициент в левой части добавлен по аналогии с предыдущим пунктом (иначе при любых значениях вектора $x$ вектор $y$ не может быть любым).
\end{enumerate}

\textbf{Подытожим}
\begin{enumerate}
	\item \fbox{<<Если $x$ имеет такой-то вид, то $y = 0$>>}
	\[
	\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i \ge y.
	\]
	
	\item \fbox{<<Если $x = 0$, то $y$ имеет такой-то вид>>}
	\[
	\abs{K^0 \cup K^1} \cdot x  \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
	
	\item \fbox{<<Если $x$ имеет такой-то вид, то $y$ имеет такой-то вид>>}
	\[
	\abs{K^0 \cup K^1} \cdot \Big(\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i\Big) \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
\end{enumerate}

\problem

Пусть есть 5 проектов, в которые можно вложиться. Для вложения в каждый проект нужно внести определённую сумму денег. Все проекты после вложения в них принесут определённый доход через какое-то время. Есть определённые условия, на которых можно вкладываться в проекты. Как получить наибольшую прибыль, имея ограниченные ресурсы?

\textbf{1. Что будем оптимизировать?} Ответ: нужно максимизировать получаемую прибыль.

\textbf{2. Что существенно влияет на оптимизируемую характеристику?}

\begin{table}[h!]
	\centering
	\begin{tabular}{| c | c | c | c | c | c |} 
		\hline
		\textbf{Проект}             & $A$ & $B$ & $C$ & $D$ & $E$ \\\hline
		\textbf{Доход}              & 3   & 2   & 1   & 4   & 2 \\\hline
		\textbf{Начальные вложения} & 1.5 & 0   & 0.5 & 4   & 1 \\\hline
	\end{tabular}
\end{table}

Условия вложения в проекты:
\begin{enumerate}[nosep]
	\item нужно вложиться хотя бы в один проект;
	
	\item если вложились в $A$, то необходимо вложиться в $D$;
	
	\item если вложились в $B$ и $C$, то необходимо вложиться в $A$;
	
	\item если вложились в $B$, то необходимо вложиться в $C$ и $E$.
\end{enumerate}

\begin{itemize}
	\item $c_i$ --- доход с проекта $i$;
	
	\item $d_i$ --- начальные вложения в проект $i$;
	
	\item $Q$ --- стартовый капитал;
	
	\item $C$ --- общий доход.
\end{itemize}

\textbf{3. Математическая формулировка задачи}

Введём булевы переменные
\[
x_i = \begin{cases}
	1, & \text{будем ли вкладываться в $i$-ый проект}, \\
	0, & \text{иначе}.
\end{cases}
\]

Введём общие расходы
\[
D = \sum_{i=1}^5 x_i d_i
\]

и общие доходы
\[
C = \sum_{i=1}^5 x_i c_i
\]

Тогда прибыль это
\[
C - D = \sum_{i=1}^5 x_i c_i - \sum_{i=1}^5 x_i d_i = \sum_{i=1}^5 x_i (c_i - d_i) \to \max_{(x_i)}
\]

У нас есть ограничения
\[
D \le Q
\]

то есть мы не можем вложить больше стартового капитала

Запишем условия вложения в проекты:
\begin{enumerate}
	\item 
	
	\[
	\sum_{i=1}^{5} x_i \ge 1
	\]
	
	\item если $x_1 = 1$, то $x_4 = 1$
	\[
	1 - x_1 \ge 1 - x_4,
	\]
	\[
	x_1 \le x_4.	
	\]
	
	\item если $x_2 = 1$ и $x_3 = 1$, то $x_1 = 1$
	\[
	(1 - x_2) + (1 - x_3) \ge 1 - x_1,
	\]
	\[
	1 + x_1 \ge x_2 + x_3.
	\]
	
	\item если $x_2 = 1$, то $x_3 = 1$ и $x_5 = 1$
	\[
	2 \cdot (1 - x_2) \ge 1 - x_3 + 1 - x_5,
	\]
	\[
	2x_2 \le x_3 + x_5.
	\]
\end{enumerate}

Итого имеем следующую математическую формулировку задачи
\[
\sum_{i=1}^5 x_i (c_i - d_i) \to \max_{(x_i)}
\]

\[
\sum_{i=1}^5 x_i d_i \le Q
\]

\[
\begin{cases}
	\sum\limits_{i=1}^{5} x_i \ge 1, \\
	x_1 \le x_4, \\
	1 + x_1 \ge x_2 + x_3, \\
	2x_2 \le x_3 + x_5;
\end{cases}
\]

\[
x_i \in \{0, 1\}.
\]

\fact[альтернативные переменные]\label{fact:alternative_conditions}

Пусть в нашей задаче сформулированы 2 ограничения
\[f_1(x) \ge b_1,\]
\[f_2(x) \ge b_2,\]

однако нам достаточно, чтобы выполнялось хотя бы одно из них. Тогда такие условия называются \definitionfont{альтернативными}. Как это можно записать алгебраически?

Предположим, что мы реализуем алгоритм, который решает нашу задачу, при этом он находит решения, которые удовлетворяют всем условиям. Введём булеву переменную $y$, значения которой определяются следующим образом 
\[
y = \begin{cases}
	0,& \text{выполнено первое ограничение}\\
	1,&\text{выполнено второе ограничение}
\end{cases}
\]

В идеальном случае наш алгоритм сам выберет значение 
этой переменной и на его основании построит оптимальное решение, однако какое бы значение он не выбрал, итоговое решение должно удовлетворять одному из ограничений. Алгебраически это можно записать так
\[f_1(x) \ge b_1 - W(1-y),\]
\[f_2(x) \ge b_2 - Wy,\]

где $W$ --- это какая-то большая величина. Какое конкретно значение эта величина принимает, зависит от конкретной задачи. Где-то можно положить $W = 10^6$, где-то $W = 50$, однако полностью избавиться от $W$ и записать условие без него не получится.

\begin{itemize}[nosep]
	\item Если $y = 1$, то имеем
	\[f_1(x) \ge b_1,\]
	\[f_2(x) \ge b_2 - W \to -\infty.\]
	
	Первое неравенство верно, как и второе. Однако если со вторым есть вопросы, а точно ли оно верно, то вот первое выполняется гарантировано.
	
	\item Если $y = 0$, то имеем
	\[f_1(x) \ge b_1 - W \to -\infty,\]
	\[f_2(x) \ge b_2.\]
	
	Аналогично, оба неравенства выполнены, но важно, что второе неравенство выполняется гарантировано.
	
\end{itemize}

\bigskip

\textbf{Другой способ}

То же самое можно записать с использованием двух булевых переменных $y_1$ и $y_2$
\[f_1(x) \ge b_1 - W(1-y_1),\]
\[f_2(x) \ge b_2 - W(1-y_2),\]
\[y_1+y_2 = 1.\]

Без условия $y_1 + y_2 = 1$ нет гарантий, что одно из неравенств будет верно.

\bigskip

\textbf{Ограничения в другую сторону}

Если у нас есть ограничения с другим знаком
\[f_1(x) \le b_1,\]
\[f_2(x) \le b_2,\]

то записать алгебраически их можно следующим образом
\[f_1(x) \le b_1 + W(1-y_1),\]
\[f_2(x) \le b_2 + Wy_2,\]
\[y_1 + y_2 = 1.\]

Аналогично можно было бы записать через $y$.

\fact[замена нелинейностей]\label{fact:substituion_of_nonlinear}

Пусть при решение задачи в некотором выражении нам встретилась какая-то нелинейность, например $\hat{x} \cdot \hat{y}$ ($\hat{x}$ и $\hat{y}$ --- булевы переменные). Работать с нелинейностями неудобно, поэтому хотелось бы заменить это на новую булеву переменную
\[
\hat{z} = \hat{x} \cdot \hat{y}.
\]

Однако просто заменить в выражении $\hat{x} \cdot \hat{y}$ на $\hat{z}$ нельзя, поскольку нужно изменить ограничения. Нам нужно ввести ограничение на новую переменную
\[
\hat{z} = 1 \quad \Longleftrightarrow \quad \hat{x} = 1 \land \hat{y} = 1
\]

Данное ограничение можно расписать через две импликации
\begin{enumerate}
	\item Если $\hat{z} = 1$, то $\hat{x} = 1$ и $\hat{y} = 1$. Данное логическое условие можно записать алгебраически, используя \cref{fact:complex_conditions}. Будем использовать самый общий случай
	\[
	x = \begin{pmatrix}\hat{z}\end{pmatrix}, \qquad y = \begin{pmatrix} \hat{x} & \hat{y} \end{pmatrix},
	\]
	\[
	I^0 = \O, \quad I^1 = \{1\}, \qquad K^0 = \O, \quad K^1 = \{1, 2\}
	\]
	\[
	\abs{K^0 \cup K^1} \cdot \Big(\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i\Big) \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k,
	\]	
	\[\Updownarrow\]	
	\[
	2 \cdot (1 - \hat{z}) \ge (1 - \hat{x}) + (1 - \hat{y}),
	\]
	\[
	2\hat{z} \le \hat{x} + \hat{y}.
	\]
	
	\item Если $\hat{x} = 1$ и $\hat{y} = 1$, то $\hat{z} = 1$. Данное логическое условие можно записать алгебраически, используя \cref{fact:complex_conditions}. Будем использовать самый общий случай
	\[
	x = \begin{pmatrix}\hat{x} & \hat{y}\end{pmatrix}, \qquad y = \begin{pmatrix} \hat{z} \end{pmatrix},
	\]
	\[
	I^0 = \O, \quad I^1 = \{1, 2\}, \qquad K^0 = \O, \quad K^1 = \{1\}
	\]
	\[
	\abs{K^0 \cup K^1} \cdot \Big(\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i\Big) \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k,
	\]
	\[\Updownarrow\]
	\[
	(1 - \hat{x}) + (1 - \hat{y}) \ge 1 - \hat{z},
	\]
	\[
	\hat{z} + 1 \ge \hat{x} + \hat{y}.
	\]
\end{enumerate}

Итого при замене $\hat{z} = \hat{x} \cdot \hat{y}$ нужно добавить два ограничения
\[
\boxed{\begin{cases}
		2\hat{z} \le \hat{x} + \hat{y}, \\
		\hat{z} + 1 \ge \hat{x} + \hat{y}.
\end{cases}}
\]

\section{задачи}

\problem[о доходах с проектов]

\problem[о продукции предприятия]

Пусть есть предприятие, которое производит определённые виды продукции, затрачивая некоторые свои ресурсы. Для простоты будем считать, что у нас есть лишь один вид ресурсов, который можно использовать для производства продукции. Как получить наибольший доход?

\textbf{1. Что будем оптимизировать?} Ответ: нужно максимизировать получаемый доход.

\textbf{2. Что существенно влияет на оптимизируемую характеристику?}

\begin{itemize}[nosep]
	\item $i = 1 \dots n$ --- вид продукции;
	
	\item $c_i$ --- доход продукции;
	
	\item $x_i$ --- количество единиц производимой продукции;
	
	\item $b_i$ --- расход ресурса на производство одной единицы продукции;
	
	\item $B$ --- запасы ресурса;
	
	\item $I = \{1, 2, \dots, n\}$.
\end{itemize}

\textbf{3. Математическая формулировка задачи}

\[
C = \sum_{i \in I}c_i x_i \to \max_{(x_i)}
\]
\[
\sum_{i \in I}b_i x_i \le B
\]
\[
\forall i \in I \quad x_i \ge 0
\]

Казалось бы, математическая модель составлена, однако тут приходит директор предприятия и говорит, что правительство определило два списка социально значимых товаров, при этом нужно либо из первого списка производить не менее стольких-то единиц продукции, либо из второго не менее стольких-то единиц продукции. Запишем эти условия

Пусть гойда

\[
\sum_{i \in i_1} x_i \ge a_1,
\]
\[
\sum_{i \in I_2} x_i \ge a_2.
\]

Нам нужно, чтобы выполнялось хотя бы одно из них. Для этого введём булевы переменную
\[
y = \begin{cases}
	0, & \text{производим не менее $a_1$ из $I_1$}, \\
	1, & \text{производим не менее $a_2$ из $I_2$}.
\end{cases}
\]

Запишем логические условия с учётом этой переменной
\[
\sum_{i \in I_1} x_i \ge a_1 - Wy,
\]
\[
\sum_{i \in I_2} x_i \ge a_2 - W(1 - y).
\]

Казалось бы, математическая модель предприятия окончательно составлена, но... К вам вновь приходит директор предприятия и говорит, что правительство издало приказ, по которому если производится достаточно продукции из обоих списков, то предприятие получит надбавку.

Пусть если $C_0$ --- надбавка за производство продукции из обоих списков социально значимых товаров. Тогда нужно переписать записанные неравенства выше с использованием двух новых булевых переменных
\[
y_1 = \begin{cases}
	1, & \text{производим не менее $a_1$ из $I_1$}, \\
	0, & \text{иначе};
\end{cases}
\]
\[
y_2 = \begin{cases}
	1, & \text{производим не менее $a_2$ из $I_2$}, \\
	0, & \text{иначе}.
\end{cases}
\]

Тогда оптимизируемая характеристика и логические условия имеют следующий вид
\[
C = \sum_{i \in I}c_i x_i + C_0 y_1 y_2 \to \max_{(x_i), y_1, y_2}
\]
\[
\sum_{i \in I_1} x_i \ge a_1 - W(1 - y_1),
\]
\[
\sum_{i \in I_2} x_i \ge a_2 - W(1 - y_2).
\]

В общем и целом теперь нас всё устраивает, кроме нелинейности в виде $y_1 y_2$. Произведём замену нелинейности и запишем ограничения на новую булеву переменную
\[
z = y_1 y_2,
\]
\[
C = \sum_{i \in I}c_i x_i + C_0 z \to \max_{(x_i), z}
\]
\[
2z \le y_1 + y_2,
\]
\[
z + 1 \ge y_1 + y_2.
\]

Итоговая математическая модель задачи со всеми условиями имеют следующий вид
\[
C = \sum_{i \in I}c_i x_i + C_0 y_1 y_2 \to \max_{(x_i), z}
\]
\[
\sum_{i \in I}b_i x_i \le B
\]
\[
\sum_{i \in I_1} x_i \ge a_1 - W(1 - y_1)
\]
\[
\sum_{i \in I_2} x_i \ge a_2 - W(1 - y_2)
\]
\[
2z \le y_1 + y_2, \quad z + 1 \ge y_1 + y_2
\]
\[
y_1 \in \{0, 1\} \quad y_2 \in \{0, 1\}
\]
\[
\forall i \in I \quad x_i \ge 0
\]
