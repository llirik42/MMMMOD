\chapter{Использование булевых переменных}

\fbox{
	\parbox{\linewidth}{
		Очень часто в реальных задачах встречаются самые разные логические условия. Например: <<если верно ..., то должно быть верно ...>>. Данные условия можно записать на языке формул математической логики, однако в рамках данного курса будет удобнее, если они будут записаны с использованием алгебраических выражений. Таким образом мы сможем записать любые ограничения любых задач на языке алгебры.

		Для записи логических условий хорошо подходят булевы переменные. Это переменные, которые могут принимать лишь два значения --- 0 и 1.
	}
}

\fact[простые условия]\label{fact:simple_conditions}

Пусть у нас есть два логических условия $A$ и $B$, и нам нужно записать на языке алгебры логическое выражение: если верно $A$, то верно $B$>>. Для этого введём две булевы переменные $x$ и $y$, смысл этих переменных будет следующий
\[
	x = \begin{cases}
		0, & \text{$A$ --- истина} \\
		1, & \text{$A$ --- ложь}
	\end{cases}
\]

\[
y = \begin{cases}
	0, & \text{$B$ --- истина} \\
	1, & \text{$B$ --- ложь}
\end{cases}
\]

Рассмотрим всевозможные комбинации событий $A$ и $B$ на языке булевых переменных.

\begin{enumerate}[nosep]
	\item <<Если верно $A$, то верно $B$>>. На языке наших переменных это записывается как <<если $x = 0$, то $y = 0$>>. Будем записывать это алгебраически следующим образом
	\[
		x \ge y.
	\]
	
	\begin{itemize}[nosep]
		\item Если $x = 0$, то $y$ не может быть равен 1, потому что $0 \ngeq 1$, значит $y$ может равняться лишь 0.
	
		\item Если $x = 1$, то $y$ может равняться как 0, так и 1, поскольку $1 \ge 0$ и $1 \ge 1$.
	\end{itemize}
	
	Значит наше неравенство по смыслу совпадает с исходным логическим условием.
	
	\item Условие <<если $x = 0$, то $y = 1$>> записывается как
	\[
		x \ge 1 - y.
	\]
	
	\begin{itemize}[nosep]
		\item Если $x = 0$, то $1-y$ не может быть равен 1, а значит $1-y=0$, как следствие $y = 1$.
		
		\item Если $x = 1$, то $1-y$ может равняться как 0, так и 1, значит $y$ может принимать любое значение из $\{0, 1\}$.
	\end{itemize}
	
	Записать через $x \ge y - 1$ было бы некорректно, поскольку при $y = 0$ в правой части получилось бы отрицательное число, а при использовании булевых переменных нужно оперировать лишь 0 и 1.
	
	\item <<Если $x = 1$, то $y = 0$>>. По аналогии с предыдущим пунктом это записывается как
	\[
		1-x \ge y.
	\]
	
	\item <<Если $x = 1$, то $y = 1$>>. По аналогии с предыдущими пунктами это записывается как
	\[
		1-x \ge 1 - y,
	\]
	
	или то же самое
	\[
		x \le y.
	\]
	
\end{enumerate}

\textbf{Подытожим}
\begin{enumerate}
	\item \fbox{<<Если $x = 0$, то $y = 0$>>} \qquad\qquad $x \ge y$.

	\item \fbox{<<Если $x = 0$, то $y = 1$>>} \qquad\qquad $x \ge 1 - y$.
	
	\item \fbox{<<Если $x = 1$, то $y = 0$>>} \qquad\qquad $1- x \ge y$.
	
	\item \fbox{<<Если $x = 1$, то $y = 1$>>} \qquad\qquad $1 - x \ge 1 - y$ \quad $\Longleftrightarrow$ \quad $x \le y$.
\end{enumerate}

\fact[сложные условия]\label{fact:complex_conditions}

Пусть теперь у нас есть множества условий $\mathcal{A} = \{A_i\}$ и $\mathcal{B} = \{B_k\}$, которым мы будем сопоставлять булевы переменные $x$ и $y$.

\begin{enumerate}[nosep]
	\item Пусть нам хочется алгебраически записать следующее условие: <<если некоторые условия из множества $\mathcal{A}$ истины (а остальные ложны), то все условия из множества $\mathcal{B}$ истины>>. Введём булев вектор $x = (x_i)$, соответствующий условиям из $\mathcal{A}$. Также введём не пересекающиеся множества индексов $I^0, I^1 \subset I$, соответствующие верным и неверным условиям из $\mathcal{A}$ следующим образом
	\[
		x_i = \begin{cases}
			0,& i \in I^0 \Leftrightarrow \text{$A_i$ --- истина}\\
			1,& i \in I^1 \Leftrightarrow \text{$A_i$ --- ложь}\\
		\end{cases}
	\]
	Ещё введём булевы переменную $y$, которая обозначает следующее
	\[
		y = \begin{cases}
			0, &\text{все условия из $\mathcal{B}$ истины} \\
			1, &\text{не все условия из $\mathcal{B}$ истины}
		\end{cases}
	\]
	
	Фактически нам бы хотелось записать следующее: <<если вектор $x$ имеет такой вид, то $y = 0$>>. Записать алгебраически это можно следующим образом
	\[
		\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i \ge y.
	\]
	
	Действительно, если вектор $x$ имеет нужный нам вид, то обе суммы равняются нулю, значит $y$ ничего не остаётся кроме как быть равным нулю.
	
	\item  Пусть нам хочется алгебраически записать следующее условие: <<если все события из $\mathcal{A}$ истины, то некоторые условия из множества $\mathcal{B}$ истины (а остальные ложны)>>. Введём булев вектор $y = (y_k)$, соответствующий условиям из $\mathcal{B}$. Также введём не пересекающиеся множества индексов $K^0, K^1 \subset K$, соответствующие верным и неверным условиям из $\mathcal{B}$ следующим образом
	\[
		y_k = \begin{cases}
			0,& k \in K^0 \Leftrightarrow \text{$B_k$ --- истина}\\
			1,& k \in K^1 \Leftrightarrow \text{$B_k$ --- ложь}\\
		\end{cases}
	\]
	Ещё введём булевы переменную $x$, которая обозначает следующее
	\[
		x = \begin{cases}
			0, &\text{все условия из $\mathcal{A}$ истины} \\
			1, &\text{не все условия из $\mathcal{A}$ истины}
		\end{cases}
	\]
	
	Фактически нам бы хотелось записать следующее: <<если $x = 0$ , то $y$ имеет такой-то вид>>. Записать алгебраически это можно следующим образом
	\[
		\abs{K^0 \cup K^1} \cdot x  \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
	
	Зачем здесь нужен коэффициент $\abs{K^0 \cup K^1}$?. Если $x = 0$, то наше условие соблюдается, поскольку в правой части тогда обе суммы должны равняться нулю, а значит $y$ принимает нужным нам вид. Однако дело в том, что если $x \neq 0$, то $y$ должен иметь возможность принимать любые значения (посылка ложна), однако алгебраически это не так. Теоретически правая часть может быть сколь угодно большой, а правая часть без коэффициента может лишь не больше 1. Это означает, что наше алгебраическое выражение по смыслу не совпадает с изначальными логическими условиями. Чтобы оно совпадало, нужно разрешить $y$ принимать любые значения при $x \neq 0$. Для этого как раз и добавлен коэффициент в левой части неравенства, чтобы неравенство оставалось верным при $x = 1$ и сколь угодно большой правой части.
	
	\item Рассмотрим самый общий случай: <<если некоторые условия из $\mathcal{A}$ истины (а остальные ложны), то некоторые условия из множества $\mathcal{B}$ истины (а остальные ложны)>>. Для этого введём булевы векторы $x = (x_i)$ и $y = (y_k)$, соответствующие условиям из $\mathcal{A}$ и $\mathcal{B}$ соответственно. Также аналогично с двумя предыдущими пунктами введём множества $I^0, I^1 \subset I$ и $K^0, K^1 \subset K$ следующим образом
	\[
		x_i = \begin{cases}
			0,& i \in I^0 \Leftrightarrow \text{$A_i$ --- истина}\\
			1,& i \in I^1 \Leftrightarrow \text{$A_i$ --- ложь}\\
		\end{cases}
	\]
	\[
		y_k = \begin{cases}
			0,& k \in K^0 \Leftrightarrow \text{$B_k$ --- истина}\\
			1,& k \in K^1 \Leftrightarrow \text{$B_k$ --- ложь}\\
		\end{cases}
	\]
	
	Фактически нам бы хотелось записать следующее: <<если $x$ имеет такой-то вид, то $y$ имеет такой-то вид>>. Записать алгебраически это можно следующим образом
	\[
		\abs{K^0 \cup K^1} \cdot \Big(\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i\Big) \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
	
	Коэффициент в левой части добавлен по аналогии с предыдущим пунктом (иначе при любых значениях вектора $x$ вектор $y$ не может быть любым).
\end{enumerate}

\textbf{Подытожим}
\begin{enumerate}
	\item \fbox{<<Если $x$ имеет такой-то вид, то $y = 0$>>}
	\[
		\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i \ge y.
	\]
	
	\item \fbox{<<Если $x = 0$, то $y$ имеет такой-то вид>>}
	\[
		\abs{K^0 \cup K^1} \cdot x  \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
	
	\item \fbox{<<Если $x$ имеет такой-то вид, то $y$ имеет такой-то вид>>}
	\[
		\abs{K^0 \cup K^1} \cdot \Big(\sum_{i \in I^1}(1-x_i) + \sum_{i \in I^0}x_i\Big) \ge \sum_{k \in K^1}(1-y_k) + \sum_{k \in K^0}y_k.
	\]
\end{enumerate}

\fact[альтернативные переменные]\label{fact:alternative_conditions}

Пусть в нашей задаче сформулированы 2 ограничения
\[f_1(x) \ge b_1,\]
\[f_2(x) \ge b_2,\]

однако нам достаточно, чтобы выполнялось хотя бы одно из них. Тогда такие условия называются \definitionfont{альтернативными}. Как это можно записать алгебраически?

Предположим, что мы реализуем алгоритм, который решает нашу проблему, при этом он находит решения, которые удовлетворяют всем условиям. Введём булевы переменную $y$, значения которой определяются следующим образом 
\[
	y = \begin{cases}
		0,& \text{выполнено первое ограничение}\\
		1,&\text{выполнено второе ограничение}
	\end{cases}
\]

В идеальном случае наш алгоритм сам выберет значение 
этой переменной и на его основании построит оптимальное решение, однако какое бы значение он не выбрал, итоговое решение должно удовлетворять одному из ограничений. Алгебраически это можно записать так
\[f_1(x) \ge b_1 - W(1-y),\]
\[f_2(x) \ge b_2 - Wy,\]

где $W$ --- это какая-то большая величина. Какое конкретно значение эта величина принимает, зависит от конкретной задачи. Где-то можно положить $W = 10^6$, где-то $W = 50$, однако полностью избавиться от $W$ и записать условие без него не получится.

\begin{itemize}[nosep]
	\item Если $y = 1$, то имеем
	\[f_1(x) \ge b_1,\]
	\[f_2(x) \ge b_2 - W \approx -\infty.\]
	
	Первое неравенство верно, как и второе. Однако если со вторым есть вопросы, а точно ли оно верно, то вот первое выполняется гарантировано.
	
	\item Если $y = 0$, то имеем
	\[f_1(x) \ge b_1 - W \approx -\infty,\]
	\[f_2(x) \ge b_2.\]
	
	Аналогично, оба неравенства выполнены, но важно, что второе неравенство выполняется гарантировано.
	
\end{itemize}

\bigskip

\textbf{Другой способ}

То же самое можно записать с использованием двух булевых переменных $y_1$ и $y_2$
\[f_1(x) \ge b_1 - W(1-y_1),\]
\[f_2(x) \ge b_2 - W(1-y_2),\]
\[y_1+y_2 = 1.\]

Без условия $y_1 + y_2 = 1$ нет гарантий, что одно из неравенств будет верно.

\bigskip

\textbf{Ограничения в другую сторону}

Если у нас есть ограничения с другим знаком
\[f_1(x) \le b_1,\]
\[f_2(x) \le b_2,\]

то записать алгебраически их можно следующим образом
\[f_1(x) \le b_1 + W(1-y_1),\]
\[f_2(x) \le b_2 + Wy_2,\]
\[y_1 + y_2 = 1.\]

Аналогично можно было бы записать через $y$.

\fact[замена нелинейностей]\label{fact:substituion_of_nonlinear}

Пусть при решение задачи в некотором выражении нам встретилась какая-то нелинейность, например $x \cdot y$ ($x$ и $y$ --- булевы переменные). Работать с нелинейностями неудобно, поэтому хотелось бы заменить это на новую булеву переменную
\[
	z = x \cdot y.
\]

Однако просто заменить в выражении $x \cdot$ на $z$ нельзя, поскольку нужно изменить ограничения. Нам нужно ввести ограничение на новую переменную
\[
	z = 1 \Longleftrightarrow x = 1 \land y = 1
\]

Данное ограничение можно расписать через две импликации
\begin{enumerate}
	\item Если $z = 1$, то $x = 1$ и $y = 1$. Данное логическое условие можно записать алгебраически, используя \ref{fact:complex_conditions}.
	\[
		2 \cdot (1 - z) \ge (1 - x) + (1 - y)
	\]

	\[
		2z \le x + y.
	\]
	
	\item Если $x = 1$ и $y = 1$, то $z = 1$. Данное логическое условие можно записать алгебраически следующим образом
	\[
		\begin{cases}
			1 - x \ge 1 - z, \\
			1 - y \ge 1 - z;
		\end{cases}
	\]
	
	\[
		2 \cdot (1 - z) \ge (1 - x) + (1 - y),
	\]
	
	\[
		2z \le x + y.
	\]
\end{enumerate}

\fact[Нахождение минимума]

Пусть в нашем выражении где-то встретилось $u = \min\{x_1, x_2\}$.
